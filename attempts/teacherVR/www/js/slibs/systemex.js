/* 
 * To change this license header, choose License Headers in Project Properties.
 * To change this template file, choose Tools | Templates
 * and open the template in the editor.
 */

/* global process, TimeUtils */

'use strict';

var SystemEx = function()
{

    var fServerDebugOn = false;
    var fIP = 'localhost'; //'192.168.2.109'; //'192.168.43.88';
    var fPort = '8181';

    var fClientDebugOn = false; //true only with 'true', can set on run
    var fDebugClientChangedEventArr = [];

    //call on new
    var fConstructor = function SystemEx()
    {
       
    };

    
    fConstructor.isOldAndroid = false;
    fConstructor.AndroidVer;

    fConstructor.init = function()
    {
        fConstructor.AndroidVer = fConstructor.getAndroidVersion();
        if (fConstructor.AndroidVer)
            fConstructor.isOldAndroid = !fConstructor.isAVerAtleastBVer(fConstructor.AndroidVer, '5.0');
    };
        
    //=----------------------------------------------------------------------
    //Textarea
    // insert the ENTER as a new line, which is missing in embedded mode (debug) for some resone
    //------- this part for embedded only, no need for Chrome or Android ----
    //=----------------------------------------------------------------------
    fConstructor.isEmbedded = function()
    {
        //Embedded: Mozilla/5.0 (Windows NT 6.2; Win64; x64) AppleWebKit/535.14 (KHTML, like Gecko) JavaFX/2.2 Safari/535.14
        //Chrome  : Mozilla/5.0 (Windows NT 6.3; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/35.0.1916.153 Safari/537.36
        var zStr = navigator.userAgent;
        //alert(zStr + '\n\n---------\n' + navigator.platform);
        return zStr && zStr.indexOf('JavaFX') > -1;
    };

    //should call as early as possible
    var fIsDesktop;
    fConstructor.setIsDesktop = function(aValue)
    {
        fIsDesktop = aValue;
    };
    
    var isDesktopApplication = function()
    {
        return false;
    };
    
    fConstructor.isBrowser = function()
    {
        if (fConstructor.isEmbedded())
            return false;
        //Embedded: Mozilla/5.0 (Windows NT 6.2; Win64; x64) AppleWebKit/535.14 (KHTML, like Gecko) JavaFX/2.2 Safari/535.14
        //Chrome  : Mozilla/5.0 (Windows NT 6.3; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/35.0.1916.153 Safari/537.36
        var zStr = navigator.userAgent;
        //navigator.platform (Win32)
        //alert(zStr + '\n\n---------\n' + navigator.platform);
        return zStr && zStr.toUpperCase().indexOf("MOBILE") < 0 && !fIsDesktop;//SUMSUNG
    };

    var fIsAndroid = navigator.userAgent.match(/Android/i);        
    fConstructor.isAndroid = function () 
    {
        //var zUserAgent = aUserAgentua || navigator.userAgent; 
        //return zUserAgent.indexOf("Android");
        return fIsAndroid;
    };

    /**
     * 
     * @param {type} aUserAgentua
     * @returns false if it's not android else ver as x.y.z
     */
    fConstructor.getAndroidVersion = function (aUserAgentua) {
        var zUserAgent = aUserAgentua || navigator.userAgent; 
        var match = zUserAgent.match(/Android\s([0-9\.]*)/);
        return match ? match[1] : false;
    };
    
    /**
     * 
     * versions must be x.y.z or x.y or x
     * @param {type} aAVer
     * @param {type} aBVer
     * @returns {Boolean}
     */
    fConstructor.isAVerGreaterThanBVer = function (aAVer, aBVer) 
    {
        return this.compareAVerToBVer(aAVer, aBVer) > 0;
    };    
    /**
     * 
     * versions must be x.y.z or x.y or x
     * @param {type} aAVer
     * @param {type} aBVer
     * @returns {Boolean}
     */
    fConstructor.isAVerAtleastBVer = function (aAVer, aBVer) 
    {
        return this.compareAVerToBVer(aAVer, aBVer) >= 0;
    };    
    /**
     * versions must be x.y.z or x.y or x
     * @param {type} aAVer
     * @param {type} aBVer
     * @returns {unresolved} aAVer > aBVer: 1, aAVer=aBVer: 0, aAVer < aBVer: -1
     */
    fConstructor.compareAVerToBVer = function (aAVer, aBVer) 
    {
        try
        {
            var zAverArr = aAVer.split('.');
            var zBverArr = aBVer.split('.');
            
            while (zAverArr.length < zBverArr.length)
                zAverArr.push('0');
            while (zAverArr.length > zBverArr.length)
                zBverArr.push('0');
            
            var zLen = zAverArr.length;
            
            for (var i = 0; i < zLen; i++)
            {
                if (parseInt(zAverArr[i]) !== parseInt(zBverArr[i]))
                    return parseInt(zAverArr[i]) > parseInt(zBverArr[i]) ? 1 : -1;
            }
            
            return 0;
            
        }
        catch (ex)
        {
            return undefined;
        }
    };

    fConstructor.getUserHome = function () 
    {
        //alert('home ' + process.env.HOME);
        //alert('HOMEPATH ' + process.env.HOMEPATH);
        //alert('USERPROFILE ' + process.env.USERPROFILE);
        var zUserHome = process.env.USERPROFILE || process.env.HOME || process.env.HOMEPATH;
        return zUserHome ? zUserHome.replace(/\\/g, "/") : "";
    };
    
    fConstructor.beeps = function(aTimes, aGapsMs) 
    {
        //var snd = new Audio("data:audio/wav;base64,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qJrx4KOQjahZxWbcZgztj2c49nKmkId44S71j0c8eV9yDK6uPRzx5X18eDvjvQ6yKo9ZSS6l//8elePK/Lf//IInrOF/FvDoADYAGBMGb7FtErm5MXMlmPAJQVgWta7Zx2go+8xJ0UiCb8LHHdftWyLJE0QIAIsI+UbXu67dZMjmgDGCGl1H+vpF4NSDckSIkk7Vd+sxEhBQMRU8j/12UIRhzSaUdQ+rQU5kGeFxm+hb1oh6pWWmv3uvmReDl0UnvtapVaIzo1jZbf/pD6ElLqSX+rUmOQNpJFa/r+sa4e/pBlAABoAAAAA3CUgShLdGIxsY7AUABPRrgCABdDuQ5GC7DqPQCgbbJUAoRSUj+NIEig0YfyWUho1VBBBA//uQZB4ABZx5zfMakeAAAAmwAAAAF5F3P0w9GtAAACfAAAAAwLhMDmAYWMgVEG1U0FIGCBgXBXAtfMH10000EEEEEECUBYln03TTTdNBDZopopYvrTTdNa325mImNg3TTPV9q3pmY0xoO6bv3r00y+IDGid/9aaaZTGMuj9mpu9Mpio1dXrr5HERTZSmqU36A3CumzN/9Robv/Xx4v9ijkSRSNLQhAWumap82WRSBUqXStV/YcS+XVLnSS+WLDroqArFkMEsAS+eWmrUzrO0oEmE40RlMZ5+ODIkAyKAGUwZ3mVKmcamcJnMW26MRPgUw6j+LkhyHGVGYjSUUKNpuJUQoOIAyDvEyG8S5yfK6dhZc0Tx1KI/gviKL6qvvFs1+bWtaz58uUNnryq6kt5RzOCkPWlVqVX2a/EEBUdU1KrXLf40GoiiFXK///qpoiDXrOgqDR38JB0bw7SoL+ZB9o1RCkQjQ2CBYZKd/+VJxZRRZlqSkKiws0WFxUyCwsKiMy7hUVFhIaCrNQsKkTIsLivwKKigsj8XYlwt/WKi2N4d//uQRCSAAjURNIHpMZBGYiaQPSYyAAABLAAAAAAAACWAAAAApUF/Mg+0aohSIRobBAsMlO//Kk4soosy1JSFRYWaLC4qZBYWFRGZdwqKiwkNBVmoWFSJkWFxX4FFRQWR+LsS4W/rFRb/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////VEFHAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAU291bmRib3kuZGUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMjAwNGh0dHA6Ly93d3cuc291bmRib3kuZGUAAAAAAAAAACU=");  
        var snd = new Audio("data:audio/wav;base64,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qJrx4KOQjahZxWbcZgztj2c49nKmkId44S71j0c8eV9yDK6uPRzx5X18eDvjvQ6yKo9ZSS6l//8elePK/Lf//IInrOF/FvDoADYAGBMGb7FtErm5MXMlmPAJQVgWta7Zx2go+8xJ0UiCb8LHHdftWyLJE0QIAIsI+UbXu67dZMjmgDGCGl1H+vpF4NSDckSIkk7Vd+sxEhBQMRU8j/12UIRhzSaUdQ+rQU5kGeFxm+hb1oh6pWWmv3uvmReDl0UnvtapVaIzo1jZbf/pD6ElLqSX+rUmOQNpJFa/r+sa4e/pBlAABoAAAAA3CUgShLdGIxsY7AUABPRrgCABdDuQ5GC7DqPQCgbbJUAoRSUj+NIEig0YfyWUho1VBBBA//uQZB4ABZx5zfMakeAAAAmwAAAAF5F3P0w9GtAAACfAAAAAwLhMDmAYWMgVEG1U0FIGCBgXBXAtfMH10000EEEEEECUBYln03TTTdNBDZopopYvrTTdNa325mImNg3TTPV9q3pmY0xoO6bv3r00y+IDGid/9aaaZTGMuj9mpu9Mpio1dXrr5HERTZSmqU36A3CumzN/9Robv/Xx4v9ijkSRSNLQhAWumap82WRSBUqXStV/YcS+XVLnSS+WLDroqArFkMEsAS+eWmrUzrO0oEmE40RlMZ5+ODIkAyKAGUwZ3mVKmcamcJnMW26MRPgUw6j+LkhyHGVGYjSUUKNpuJUQoOIAyDvEyG8S5yfK6dhZc0Tx1KI/gviKL6qvvFs1+bWtaz58uUNnryq6kt5RzOCkPWlVqVX2a/EEBUdU1KrXLf40GoiiFXK///qpoiDXrOgqDR38JB0bw7SoL+ZB9o1RCkQjQ2CBYZKd/+VJxZRRZlqSkKiws0WFxUyCwsKiMy7hUVFhIaCrNQsKkTIsLivwKKigsj8XYlwt/WKi2N4d//uQRCSAAjURNIHpMZBGYiaQPSYyAAABLAAAAAAAACWAAAAApUF/Mg+0aohSIRobBAsMlO//Kk4soosy1JSFRYWaLC4qZBYWFRGZdwqKiwkNBVmoWFSJkWFxX4FFRQWR+LsS4W/rFRb/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////VEFHAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAU291bmRib3kuZGUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMjAwNGh0dHA6Ly93d3cuc291bmRib3kuZGUAAAAAAAAAACU=");  
        
        if (aTimes < 2)
        {
            snd.play();
            return;
        }

        for (var i = 0; i < aTimes; i++)
        {
            setTimeout(function()
            {
                snd.play();
            }, aGapsMs*i);
                
        }
    };
    
    fConstructor.beep = function() 
    {
        fConstructor.beeps(1, 0);
    };
    //----------------
    //----------------
    //----------------
    
    fConstructor.setIP = function(aIP)
    {
        fIP = aIP;
    };
    fConstructor.setPort = function(aPort)
    {
        fPort = aPort;
    };

    
    fConstructor.toggleServerDebug = function(aElementID, aOnColor, aOffColor)
    {
        fServerDebugOn = !fServerDebugOn;
        var zOnOff = fServerDebugOn ? 'on' : 'off';
        fConstructor.requestFromServer('debug/info/' + zOnOff);
        
        var zElement = document.getElementById(aElementID);
        if (fConstructor.isServerDebugOn())
        {
            zElement.title = 'Server Debug On';
            zElement.style.background = aOnColor;
        }
        else
        {
            zElement.title = 'Server Debug Off';
            zElement.style.background = aOffColor;
        }
        
    };
    
    fConstructor.isServerDebugOn = function()
    {
        return isServerDebugOn_();
    };
    var isServerDebugOn_ = function()
    {
        return fServerDebugOn;
    };

    fConstructor.toggleClientDebug = function(aElementID, aOnColor, aOffColor)
    {
        fClientDebugOn = !fClientDebugOn;
        var zElement = document.getElementById(aElementID);
        if (isClientDebugOn_())
        {
            zElement.title = 'Client Debug On';
            zElement.style.background = aOnColor;
        }
        else
        {
            zElement.title = 'Client Debug Off';
            zElement.style.background = aOffColor;
        }
        
        for (var I in fDebugClientChangedEventArr)
            fDebugClientChangedEventArr[I]();
        
    };
    
    fConstructor.addDebugClientChangedEvent = function(aEvent)
    {
        fDebugClientChangedEventArr.push(aEvent);
    };
    
    fConstructor.isClientDebugOn = function()
    {
        return isClientDebugOn_();
    };
    var isClientDebugOn_ = function()
    {
        return fClientDebugOn;
    };
    
    fConstructor.DebugTypes = 
            {
                Feedback: 'Feedback',
                ConsoleInfo: 'ConsoleInfo',
                ConsoleError: 'ConsoleError'
            };

    fConstructor.debug = function (aType, aMsg)
    {
        debug_(aType, aMsg);
    };
    var debug_ = function (aType, aMsg)
    {
        if (!isClientDebugOn_())
            return;
        
        switch (aType)
        {
            case fConstructor.DebugTypes.Feedback:
                debugFeedback_(aMsg);
                break;

            case fConstructor.DebugTypes.ConsoleInfo:
                console.info(aMsg);
                break;
                
            case fConstructor.DebugTypes.ConsoleError:
                console.error(aMsg);
                break;
        }
    };
    
    //--------
    fConstructor.requestFromServer = function(aRequest)
    {
        //alert('Play VR');
        openURL('http://' + fIP + ':' + fPort + '/classvr/' + aRequest);
    };
    
    var openURL = function(aUrl)
    { 
        if (!aUrl)
            return;
        aUrl = encodeURI(aUrl);
        
        if (isDesktopApplication())
            callBrowser(aUrl, true);
        else
        if (fConstructor.isBrowser())
            window.open(aUrl, "_blank");
        else //mobile   
            window.open(aUrl, "_system");//openURL_(aUrl);
    };
    
    //=============================================
    
    return fConstructor;
}();

SystemEx.init();